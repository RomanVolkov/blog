<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to make debugQuickLookObject work on Mac Catalyst | </title><meta name=keywords content><meta name=description content="In Vectornator we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and CGPath under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.
It&rsquo;s possible to do that with implementing an objc function - debugQuickLookObject."><meta name=author content="Roman Volkov"><link rel=canonical href=https://romanvolkov.ru/posts/xcode-custom-quick-look/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://romanvolkov.ru/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://romanvolkov.ru/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://romanvolkov.ru/favicon-32x32.png><link rel=apple-touch-icon href=https://romanvolkov.ru/apple-touch-icon.png><link rel=mask-icon href=https://romanvolkov.ru/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.128.0"><link rel=alternate hreflang=en href=https://romanvolkov.ru/posts/xcode-custom-quick-look/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="How to make debugQuickLookObject work on Mac Catalyst"><meta property="og:description" content="In Vectornator we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and CGPath under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.
It&rsquo;s possible to do that with implementing an objc function - debugQuickLookObject."><meta property="og:type" content="article"><meta property="og:url" content="https://romanvolkov.ru/posts/xcode-custom-quick-look/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-15T22:44:35+03:00"><meta property="article:modified_time" content="2023-03-15T22:44:35+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to make debugQuickLookObject work on Mac Catalyst"><meta name=twitter:description content="In Vectornator we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and CGPath under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.
It&rsquo;s possible to do that with implementing an objc function - debugQuickLookObject."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"How to make debugQuickLookObject work on Mac Catalyst","item":"https://romanvolkov.ru/posts/xcode-custom-quick-look/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to make debugQuickLookObject work on Mac Catalyst","name":"How to make debugQuickLookObject work on Mac Catalyst","description":"In Vectornator we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and CGPath under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.\nIt\u0026rsquo;s possible to do that with implementing an objc function - debugQuickLookObject.","keywords":[],"articleBody":"In Vectornator we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and CGPath under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.\nIt’s possible to do that with implementing an objc function - debugQuickLookObject. And we’ve been thinking that we already have CoreGraphics-based rendering of our custom elements into bitmap, so why not just return UIImage backend by CGImage bitmap?\nIn normal iOS/macOS application this will work (UIImage for iOS and NSImage for macOS). But since our macOS application is done via Mac Catalyst we have to deal with UIKit classes only. And we did something like this\nextension Artboard { @objc public func debugQuickLookObject() -\u003e AnyObject { guard let image = BitmapRepresentor.image(for: self, includeBackground: true) else { let msg = \"BitmapRepresentor returned a nil image for \\(debugDescription)\" + \" (artboard styleBounds: \\(styleBounds))\" return NSString(string: msg) } return image } } And on the iOS everything looks good! But if we trying to check the same Layer with Quick look we see this Especially interesting that it says something about Optional, but debugQuickLookObject clearly return non-optional value (and it works on iOS). After some research we found that it’s common problem for Mac Catalyst to work with UIImage preview.\nBut after some time we noticed that quick look for CIImage works correctly. And we gave it a try. We just took bitmap and wrap it into CIImage(cgImage: cgImage) and check the quick look. Turned out it’s working. But having preview with additional CoreImage graph is not so convenient. But now we know that the problem is only with UIImage and not all bitmaps preview.\nAnother possible class that represents only bitmap data is SKTexture. We tried to use it and that was the best workaround for us!\nextension Artboard { @objc public func debugQuickLookObject() -\u003e AnyObject { guard let image = BitmapRepresentor.image(for: self, includeBackground: true) else { let msg = \"BitmapRepresentor returned a nil image for \\(debugDescription)\" + \" (artboard styleBounds: \\(styleBounds))\" return NSString(string: msg) } #if targetEnvironment(macCatalyst) return SKTexture(cgImage: image.cgImage!) #else return image #endif } } Recompile \u0026 run to see the result.\nProfit.\n","wordCount":"382","inLanguage":"en","datePublished":"2023-03-15T22:44:35+03:00","dateModified":"2023-03-15T22:44:35+03:00","author":{"@type":"Person","name":"Roman Volkov"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://romanvolkov.ru/posts/xcode-custom-quick-look/"},"publisher":{"@type":"Organization","name":"","logo":{"@type":"ImageObject","url":"https://romanvolkov.ru/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://romanvolkov.ru/>Home</a></div><h1 class=post-title>How to make debugQuickLookObject work on Mac Catalyst</h1><div class=post-meta>&lt;span title='2023-03-15 22:44:35 +0300 +0300'>March 15, 2023&lt;/span>&amp;nbsp;·&amp;nbsp;Roman Volkov</div></header><div class=post-content><p>In <a href=https://vectornator.io/>Vectornator</a> we have lots of different types of elements that has to be rendered on the screen. E.g., shapes, artboards, layers and so on. And even if they are using CoreGraphics and <code>CGPath</code> under the hood there was still no convenient way to visualize elements during debugging. So we decided to add Quick look support for Xcode debugger.</p><p>It&rsquo;s possible to do that with implementing an objc function - <a href=https://developer.apple.com/library/archive/documentation/IDEs/Conceptual/CustomClassDisplay_in_QuickLook/CH01-quick_look_for_custom_objects/CH01-quick_look_for_custom_objects.html><code>debugQuickLookObject</code></a>. And we&rsquo;ve been thinking that we already have CoreGraphics-based rendering of our custom elements into bitmap, so why not just return <code>UIImage</code> backend by <code>CGImage</code> bitmap?</p><p>In normal iOS/macOS application this will work (<code>UIImage</code> for iOS and <code>NSImage</code> for macOS). But since our macOS application is done via Mac Catalyst we have to deal with UIKit classes only. And we did something like this</p><pre tabindex=0><code>extension Artboard {
    @objc
    public func debugQuickLookObject() -&gt; AnyObject {
        guard let image = BitmapRepresentor.image(for: self, includeBackground: true) else {
            let msg = &#34;BitmapRepresentor returned a nil image for \(debugDescription)&#34;
                + &#34; (artboard styleBounds: \(styleBounds))&#34;
            return NSString(string: msg)
        }

        return image
    }
}
</code></pre><p>And on the iOS everything looks good!
<img loading=lazy src=../images/xcode-custom-quick-look/layer_preview.jpg alt="iOS example"></p><p>But if we trying to check the same <code>Layer</code> with Quick look we see this
<img loading=lazy src=../images/xcode-custom-quick-look/layer_failed_preview.png alt="macOS failed preview"></p><p>Especially interesting that it says something about <code>Optional</code>, but <code>debugQuickLookObject</code> clearly return non-optional value (and it works on iOS). After some research we found that it&rsquo;s common problem for Mac Catalyst to work with <code>UIImage</code> preview.</p><p>But after some time we noticed that quick look for <code>CIImage</code> works correctly. And we gave it a try. We just took bitmap and wrap it into <code>CIImage(cgImage: cgImage)</code> and check the quick look. Turned out it&rsquo;s working. But having preview with additional CoreImage graph is not so convenient. But now we know that the problem is only with <code>UIImage</code> and not all bitmaps preview.</p><p><img loading=lazy src=../images/xcode-custom-quick-look/ciimage_preview.png alt="ciimage preview"></p><p>Another possible class that represents only bitmap data is <code>SKTexture</code>. We tried to use it and that was the best workaround for us!</p><pre tabindex=0><code>extension Artboard {
    @objc
    public func debugQuickLookObject() -&gt; AnyObject {
        guard let image = BitmapRepresentor.image(for: self, includeBackground: true) else {
            let msg = &#34;BitmapRepresentor returned a nil image for \(debugDescription)&#34;
                + &#34; (artboard styleBounds: \(styleBounds))&#34;
            return NSString(string: msg)
        }

        #if targetEnvironment(macCatalyst)
        return SKTexture(cgImage: image.cgImage!)
        #else
        return image
        #endif
    }
}
</code></pre><p>Recompile & run to see the result.</p><p><img loading=lazy src=../images/xcode-custom-quick-look/quick-look-result.png alt="result image"></p><p>Profit.</p></div><footer class=post-footer><nav class=paginav><a class=next href=https://romanvolkov.ru/posts/notes_about_leadership/><span class=title>Next Page »</span><br><span>Notes about remote leadership</span></a></nav></footer></article></main><footer class=footer style=font-size:13px><span>Made by Roman Volkov</span></footer></body></html>